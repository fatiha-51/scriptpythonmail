from flask import Flask, request, jsonify
from gtts import gTTS
import os

app = Flask(__name__)

@app.route('/generate-audio', methods=['POST'])
def generate_audio():
    try:
        # Récupérer les données envoyées par n8n
        data = request.json
        nom = data.get('nom', 'Expéditeur inconnu')
        sujet = data.get('sujet', 'Sans sujet')
        contenu = data.get('contenu', 'Aucun message')
        
        # Construire le message audio
        texte_email = f"Vous avez reçu un mail de {nom}. Sujet : {sujet}. Voici le message : {contenu}."
        
        # Convertir le texte en audio
        tts = gTTS(texte_email, lang='fr')
        audio_filename = "email_audio.mp3"
        tts.save(audio_filename)
        
        return jsonify({"message": "✅ Audio généré avec succès", "filename": audio_filename})
    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == '__main__':
    port = int(os.environ.get("PORT", 10000))
    app.run(host='0.0.0.0', port=port)
